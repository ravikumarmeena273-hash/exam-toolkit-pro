<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Testbook Mock Test - Advanced Edition (Fixed)</title>

<script>
  window.MathJax = {
    tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
    svg: { fontCache: 'global' }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/smiles-drawer@2.0.1/dist/smiles-drawer.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Inter', 'Noto Sans Devanagari', sans-serif; background: #f0f2f5; color: #1a1a1a; overflow-x: hidden; }

/* Setup Container */
.setup-page { min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; padding: 20px; }
.setup-card { background: white; max-width: 900px; width: 100%; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
.setup-header { background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%); padding: 30px; color: white; text-align: center; }
.setup-header h1 { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
.setup-header p { opacity: 0.9; font-size: 15px; }
.setup-body { padding: 40px; }
.form-section { margin-bottom: 30px; }
.section-title { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
.section-title::before { content: ''; width: 4px; height: 24px; background: #00bcd4; border-radius: 2px; }
textarea { width: 100%; height: 220px; font-family: 'Courier New', monospace; font-size: 13px; padding: 16px; border: 2px solid #e0e0e0; border-radius: 10px; margin-bottom: 15px; resize: vertical; transition: all 0.3s; }
textarea:focus { outline: none; border-color: #00bcd4; box-shadow: 0 0 0 3px rgba(0,188,212,0.1); }
.config-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 15px; }
.input-group { display: flex; flex-direction: column; }
.input-group label { font-size: 13px; font-weight: 600; color: #555; margin-bottom: 8px; }
.input-group input { padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: all 0.3s; }
.input-group input:focus { outline: none; border-color: #00bcd4; box-shadow: 0 0 0 3px rgba(0,188,212,0.1); }
.btn-container { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 25px; }
.btn { padding: 14px 28px; border: none; border-radius: 8px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; }
.btn-primary { background: #00bcd4; color: white; box-shadow: 0 4px 12px rgba(0,188,212,0.3); }
.btn-primary:hover { background: #0097a7; transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,188,212,0.4); }
.btn-success { background: #4caf50; color: white; box-shadow: 0 4px 12px rgba(76,175,80,0.3); }
.btn-success:hover { background: #45a049; transform: translateY(-2px); }
.btn-warning { background: #ff9800; color: white; box-shadow: 0 4px 12px rgba(255,152,0,0.3); }
.btn-warning:hover { background: #fb8c00; transform: translateY(-2px); }
.btn-danger { background: #f44336; color: white; box-shadow: 0 4px 12px rgba(244,67,54,0.3); }
.btn-danger:hover { background: #e53935; transform: translateY(-2px); }

/* Test Interface */
.test-container { display: none; height: 100vh; flex-direction: column; background: #f5f7fa; }

/* Header Bar */
.test-header { background: linear-gradient(90deg, #00bcd4 0%, #00acc1 100%); color: white; padding: 0 30px; height: 70px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 8px rgba(0,0,0,0.15); position: relative; z-index: 100; }
.test-info { display: flex; align-items: center; gap: 20px; }
.test-logo { width: 40px; height: 40px; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; color: #00bcd4; font-size: 20px; }
.test-title-section h2 { font-size: 18px; font-weight: 600; margin-bottom: 2px; }
.test-subtitle { font-size: 12px; opacity: 0.85; }
.timer-section { display: flex; align-items: center; gap: 20px; }
.timer-label { font-size: 13px; opacity: 0.9; }
.timer-display { background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 8px; font-size: 20px; font-weight: 700; font-family: 'Courier New', monospace; letter-spacing: 1px; min-width: 120px; text-align: center; backdrop-filter: blur(10px); }
.timer-display.warning { background: #ff5722; animation: timerPulse 1s infinite; }
@keyframes timerPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

/* Main Content */
.test-main { display: flex; flex: 1; overflow: hidden; }

/* Question Section */
.question-section { flex: 1; overflow-y: auto; background: #f5f7fa; padding: 25px 30px; }
.question-card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 20px; overflow: hidden; }
.question-header-card { padding: 20px 25px; border-bottom: 2px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; background: linear-gradient(to right, #fafbfc, #ffffff); }
.question-meta { display: flex; align-items: center; gap: 15px; }
.question-number-badge { background: linear-gradient(135deg, #00bcd4, #0097a7); color: white; padding: 8px 16px; border-radius: 8px; font-weight: 700; font-size: 15px; }
.question-info { display: flex; gap: 12px; }
.marks-info { background: #e8f5e9; color: #2e7d32; padding: 6px 14px; border-radius: 6px; font-size: 13px; font-weight: 600; }
.negative-info { background: #ffebee; color: #c62828; padding: 6px 14px; border-radius: 6px; font-size: 13px; font-weight: 600; }
.time-spent { color: #666; font-size: 13px; display: flex; align-items: center; gap: 5px; }

.question-content-card { padding: 30px; }
.question-text { font-size: 17px; line-height: 1.9; color: #2c3e50; font-weight: 500; margin-bottom: 25px; }
.options-list { display: flex; flex-direction: column; gap: 14px; }
.option-box { background: #fafbfc; border: 2px solid #e8eaed; border-radius: 10px; padding: 18px 20px; cursor: pointer; transition: all 0.3s; display: flex; align-items: flex-start; gap: 15px; position: relative; }
.option-box:hover { background: #f0f7ff; border-color: #00bcd4; transform: translateX(5px); }
.option-box.selected { background: #e0f7fa; border-color: #00bcd4; border-width: 2px; box-shadow: 0 4px 12px rgba(0,188,212,0.2); }
.option-box.correct-answer { background: #e8f5e9; border-color: #4caf50; }
.option-box.wrong-answer { background: #ffebee; border-color: #f44336; }
.option-checkbox { width: 28px; height: 28px; border: 2px solid #bdbdbd; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; background: white; transition: all 0.3s; }
.option-box.selected .option-checkbox { background: #00bcd4; border-color: #00bcd4; }
.option-box.selected .option-checkbox::after { content: '‚úì'; color: white; font-weight: bold; font-size: 16px; }
.option-box.correct-answer .option-checkbox { background: #4caf50; border-color: #4caf50; }
.option-box.correct-answer .option-checkbox::after { content: '‚úì'; color: white; font-weight: bold; }
.option-box.wrong-answer .option-checkbox { background: #f44336; border-color: #f44336; }
.option-box.wrong-answer .option-checkbox::after { content: '‚úó'; color: white; font-weight: bold; }
.option-label-text { font-weight: 600; color: #37474f; min-width: 28px; font-size: 15px; }
.option-content { flex: 1; line-height: 1.7; color: #37474f; font-size: 15px; }

/* Solution Panel */
.solution-panel { background: linear-gradient(to right, #fff3e0, #fffbf5); border: 2px solid #ff9800; border-radius: 12px; padding: 25px; margin-top: 25px; display: none; }
.solution-panel.visible { display: block; animation: slideDown 0.4s ease; }
@keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
.solution-header { display: flex; align-items: center; gap: 12px; margin-bottom: 18px; padding-bottom: 15px; border-bottom: 2px solid #ffe0b2; }
.solution-icon { width: 36px; height: 36px; background: #ff9800; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }
.solution-title { font-size: 16px; font-weight: 700; color: #e65100; }
.solution-correct { margin-bottom: 15px; }
.solution-correct strong { color: #2e7d32; font-size: 15px; }
.solution-correct-value { display: inline-block; background: #4caf50; color: white; padding: 4px 12px; border-radius: 6px; font-weight: 600; margin-left: 8px; }
.solution-explanation { margin-top: 12px; }
.solution-explanation strong { color: #e65100; display: block; margin-bottom: 8px; font-size: 15px; }
.solution-text { line-height: 1.8; color: #5d4037; }

/* Right Sidebar */
.right-sidebar { width: 340px; background: white; border-left: 1px solid #e0e0e0; display: flex; flex-direction: column; overflow-y: auto; }
.sidebar-section { padding: 25px 20px; border-bottom: 1px solid #f0f0f0; }
.user-profile { text-align: center; }
.user-avatar-circle { width: 70px; height: 70px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; align-items: center; justify-content: center; font-size: 30px; font-weight: 700; margin: 0 auto 12px; border: 4px solid #f0f0f0; }
.user-name-display { font-weight: 600; font-size: 17px; color: #333; }
.user-email { font-size: 13px; color: #999; margin-top: 4px; }

.legend-section .section-heading { font-size: 14px; font-weight: 700; color: #666; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 0.5px; }
.legend-items { display: flex; flex-direction: column; gap: 12px; }
.legend-row { display: flex; align-items: center; gap: 12px; }
.legend-circle { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; flex-shrink: 0; }
.legend-circle.answered { background: #4caf50; color: white; }
.legend-circle.not-answered { background: #f44336; color: white; }
.legend-circle.marked { background: #9c27b0; color: white; }
.legend-circle.not-visited { background: white; border: 2px solid #bdbdbd; color: #999; }
.legend-circle.marked-answered { background: #673ab7; color: white; }
.legend-text { font-size: 13px; color: #555; flex: 1; }
.legend-count { background: #f5f5f5; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; color: #666; }

.palette-section { flex: 1; }
.palette-section .section-heading { font-size: 14px; font-weight: 700; color: #666; margin-bottom: 18px; text-transform: uppercase; letter-spacing: 0.5px; }
.palette-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
.palette-button { width: 100%; aspect-ratio: 1; border: 2px solid #e0e0e0; background: white; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 14px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; color: #666; position: relative; }
.palette-button:hover { transform: scale(1.1); box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 10; }
.palette-button.answered { background: #4caf50; color: white; border-color: #4caf50; }
.palette-button.not-answered { background: #f44336; color: white; border-color: #f44336; }
.palette-button.marked { background: #9c27b0; color: white; border-color: #9c27b0; }
.palette-button.marked-answered { background: #673ab7; color: white; border-color: #673ab7; }
.palette-button.active { border: 3px solid #ff9800; box-shadow: 0 0 0 3px rgba(255,152,0,0.3); transform: scale(1.15); z-index: 20; }

.submit-section { padding: 20px; }
.submit-button { width: 100%; background: linear-gradient(135deg, #f44336, #e53935); color: white; border: none; padding: 16px; border-radius: 10px; font-weight: 700; font-size: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(244,67,54,0.3); }
.submit-button:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(244,67,54,0.4); }

/* Bottom Navigation */
.bottom-nav { background: white; border-top: 2px solid #f0f0f0; padding: 18px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 -2px 8px rgba(0,0,0,0.05); }
.nav-left, .nav-right { display: flex; gap: 12px; }
.nav-btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
.nav-btn-mark { background: #fff3e0; color: #f57c00; border: 2px solid #ffe0b2; }
.nav-btn-mark:hover { background: #ffe0b2; transform: translateY(-2px); }
.nav-btn-clear { background: #ffebee; color: #c62828; border: 2px solid #ffcdd2; }
.nav-btn-clear:hover { background: #ffcdd2; transform: translateY(-2px); }
.nav-btn-prev { background: #e3f2fd; color: #1976d2; border: 2px solid #bbdefb; }
.nav-btn-prev:hover { background: #bbdefb; transform: translateY(-2px); }
.nav-btn-next { background: #4caf50; color: white; border: none; box-shadow: 0 4px 12px rgba(76,175,80,0.3); }
.nav-btn-next:hover { background: #45a049; transform: translateY(-2px); box-shadow: 0 6px 16px rgba(76,175,80,0.4); }

/* Results Page */
.results-page { display: none; min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px 20px; }
.results-container { max-width: 1200px; margin: 0 auto; }
.results-card { background: white; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
.results-header { background: linear-gradient(135deg, #00bcd4, #0097a7); color: white; padding: 40px; text-align: center; }
.results-header h1 { font-size: 32px; font-weight: 700; margin-bottom: 10px; }
.results-header p { opacity: 0.9; font-size: 16px; }
.score-showcase { background: white; color: #00bcd4; padding: 30px; margin: 30px auto; border-radius: 20px; max-width: 300px; text-align: center; box-shadow: 0 8px 24px rgba(0,0,0,0.15); }
.score-value { font-size: 64px; font-weight: 800; }
.score-label { font-size: 18px; color: #666; margin-top: 8px; }

.results-body { padding: 40px; }
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 40px; }
.stat-box { background: linear-gradient(135deg, #f5f7fa, #ffffff); padding: 25px; border-radius: 12px; border-left: 5px solid #00bcd4; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.stat-number { font-size: 36px; font-weight: 800; color: #00bcd4; margin-bottom: 8px; }
.stat-label { font-size: 14px; color: #666; font-weight: 500; }
.stat-box:nth-child(2) { border-left-color: #4caf50; }
.stat-box:nth-child(2) .stat-number { color: #4caf50; }
.stat-box:nth-child(3) { border-left-color: #ff9800; }
.stat-box:nth-child(3) .stat-number { color: #ff9800; }
.stat-box:nth-child(4) { border-left-color: #f44336; }
.stat-box:nth-child(4) .stat-number { color: #f44336; }
.stat-box:nth-child(5) { border-left-color: #9c27b0; }
.stat-box:nth-child(5) .stat-number { color: #9c27b0; }

.analysis-section { margin-top: 40px; }
.analysis-header { font-size: 24px; font-weight: 700; color: #333; margin-bottom: 25px; display: flex; align-items: center; gap: 12px; }
.analysis-header::before { content: 'üìä'; font-size: 28px; }
.question-analysis-item { background: #fafbfc; border-radius: 12px; padding: 25px; margin-bottom: 18px; border-left: 5px solid #e0e0e0; transition: all 0.3s; }
.question-analysis-item:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.question-analysis-item.correct { border-left-color: #4caf50; background: linear-gradient(to right, #e8f5e9, #fafbfc); }
.question-analysis-item.incorrect { border-left-color: #f44336; background: linear-gradient(to right, #ffebee, #fafbfc); }
.question-analysis-item.unattempted { border-left-color: #9e9e9e; }
.analysis-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.analysis-q-number { font-weight: 700; font-size: 16px; color: #333; }
.analysis-status { padding: 6px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; }
.analysis-status.correct { background: #4caf50; color: white; }
.analysis-status.incorrect { background: #f44336; color: white; }
.analysis-status.unattempted { background: #9e9e9e; color: white; }
.analysis-item-content { font-size: 14px; line-height: 1.8; color: #555; }
.analysis-answer-row { display: flex; gap: 20px; margin-top: 12px; padding-top: 12px; border-top: 1px dashed #e0e0e0; }
.analysis-answer-row div { flex: 1; }
.analysis-answer-row strong { display: block; margin-bottom: 5px; font-size: 13px; color: #666; }

.results-actions { display: flex; gap: 15px; justify-content: center; margin-top: 30px; padding-top: 30px; border-top: 2px solid #f0f0f0; }

/* Print Styles */
@media print {
  @page { size: A4; margin: 15mm; }
  body { background: white; }
  .setup-page, .test-container, .results-page { display: none !important; }
  .print-mode { display: block !important; }
  .page-break { page-break-before: always; }
  .no-page-break { page-break-inside: avoid; }
}

.print-mode { display: none; background: white; padding: 0; }
.print-page { background: white; padding: 20px; }

/* Print Header */
.print-report-header { text-align: center; border-bottom: 3px solid #00bcd4; padding-bottom: 20px; margin-bottom: 30px; }
.print-report-header h1 { color: #00bcd4; font-size: 28px; margin-bottom: 10px; }
.print-report-header .test-info-line { font-size: 14px; color: #666; margin: 5px 0; }

/* Print Score Card */
.print-score-card { background: linear-gradient(135deg, #e0f7fa, #b2ebf2); border: 3px solid #00bcd4; border-radius: 12px; padding: 25px; margin-bottom: 30px; }
.print-score-header { text-align: center; margin-bottom: 20px; }
.print-score-header h2 { color: #00838f; font-size: 24px; margin-bottom: 10px; }
.print-score-main { display: flex; justify-content: center; align-items: center; margin-bottom: 20px; }
.print-score-value { font-size: 48px; font-weight: 800; color: #00695c; background: white; padding: 20px 40px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.print-score-stats { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-top: 20px; }
.print-stat-item { background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
.print-stat-number { font-size: 24px; font-weight: 700; margin-bottom: 5px; }
.print-stat-label { font-size: 12px; color: #666; font-weight: 600; }
.print-stat-item.correct .print-stat-number { color: #4caf50; }
.print-stat-item.incorrect .print-stat-number { color: #f44336; }
.print-stat-item.unattempted .print-stat-number { color: #ff9800; }
.print-stat-item.accuracy .print-stat-number { color: #2196f3; }
.print-stat-item.time .print-stat-number { color: #9c27b0; }

/* Print Questions */
.print-questions-section { margin-top: 30px; }
.print-section-title { background: #00bcd4; color: white; padding: 12px 20px; border-radius: 8px; font-size: 18px; font-weight: 700; margin-bottom: 20px; }
.print-question-block { background: #fafafa; border: 2px solid #e0e0e0; border-radius: 10px; padding: 20px; margin-bottom: 20px; page-break-inside: avoid; }
.print-q-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 2px solid #e0e0e0; }
.print-q-number { font-size: 16px; font-weight: 700; color: #00bcd4; }
.print-q-badges { display: flex; gap: 10px; }
.print-badge { padding: 5px 12px; border-radius: 6px; font-size: 11px; font-weight: 600; }
.print-badge.marks { background: #e8f5e9; color: #2e7d32; }
.print-badge.time { background: #e3f2fd; color: #1565c0; }
.print-badge.correct { background: #4caf50; color: white; }
.print-badge.incorrect { background: #f44336; color: white; }
.print-badge.unattempted { background: #ff9800; color: white; }
.print-q-text { font-size: 15px; line-height: 1.8; color: #333; margin-bottom: 15px; font-weight: 500; }
.print-options { margin-top: 15px; }
.print-option { display: flex; align-items: flex-start; gap: 12px; padding: 12px; margin-bottom: 10px; border-radius: 8px; background: white; border: 2px solid #e0e0e0; }
.print-option.user-selected { border-color: #2196f3; background: #e3f2fd; }
.print-option.is-correct { border-color: #4caf50; background: #e8f5e9; }
.print-option.user-selected.is-correct { border-color: #4caf50; background: #c8e6c9; }
.print-option.user-selected:not(.is-correct) { border-color: #f44336; background: #ffebee; }
.print-option-indicator { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; flex-shrink: 0; border: 2px solid #bdbdbd; background: white; }
.print-option.user-selected .print-option-indicator { background: #2196f3; color: white; border-color: #2196f3; }
.print-option.is-correct .print-option-indicator { background: #4caf50; color: white; border-color: #4caf50; }
.print-option.is-correct .print-option-indicator::after { content: '‚úì'; }
.print-option.user-selected:not(.is-correct) .print-option-indicator { background: #f44336; color: white; border-color: #f44336; }
.print-option.user-selected:not(.is-correct) .print-option-indicator::after { content: '‚úó'; }
.print-option-label { font-weight: 700; min-width: 20px; color: #555; }
.print-option-text { flex: 1; line-height: 1.6; color: #333; }
.print-explanation { background: #fff3e0; border-left: 4px solid #ff9800; padding: 15px; margin-top: 15px; border-radius: 6px; }
.print-explanation-title { font-weight: 700; color: #e65100; margin-bottom: 8px; font-size: 14px; }
.print-explanation-text { color: #5d4037; line-height: 1.7; font-size: 13px; }

/* Chemical & Image Placeholders */
canvas.chem-canvas { border: 2px solid #e0e0e0; border-radius: 8px; margin: 10px 0; background: white; }
.image-placeholder { background: linear-gradient(135deg, #fff3e0, #ffe0b2); border: 2px dashed #ff9800; padding: 20px; border-radius: 10px; text-align: center; color: #e65100; font-weight: 600; margin: 15px 0; }

/* Scrollbar */
::-webkit-scrollbar { width: 10px; }
::-webkit-scrollbar-track { background: #f1f1f1; }
::-webkit-scrollbar-thumb { background: #00bcd4; border-radius: 5px; }
::-webkit-scrollbar-thumb:hover { background: #0097a7; }

/* Responsive */
@media (max-width: 1024px) {
  .test-main { flex-direction: column; }
  .right-sidebar { width: 100%; border-left: none; border-top: 1px solid #e0e0e0; max-height: 300px; }
  .palette-grid { grid-template-columns: repeat(10, 1fr); }
}

@media (max-width: 768px) {
  .test-header { padding: 0 15px; height: auto; flex-direction: column; gap: 15px; padding-top: 15px; padding-bottom: 15px; }
  .question-section { padding: 15px; }
  .config-grid { grid-template-columns: 1fr; }
  .bottom-nav { flex-direction: column; gap: 10px; }
  .nav-left, .nav-right { width: 100%; }
  .nav-btn { flex: 1; justify-content: center; }
}
</style>
</head>
<body>

<!-- Setup Page -->
<div class="setup-page" id="setupPage">
  <div class="setup-card">
    <div class="setup-header">
      <h1>üéØ Testbook Style Mock Test Engine</h1>
      <p>Professional ‚Ä¢ Interactive ‚Ä¢ Real-time Analysis</p>
    </div>
    <div class="setup-body">
      <div class="form-section">
        <div class="section-title">üìù Test Questions</div>
        <textarea id="inputQuestions" placeholder="Paste your questions here in this format:

###Q1 What is DDR SDRAM ‡§ï‡§æ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∞‡•Ç‡§™ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?
##A ‡§°‡§¨‡§≤ ‡§°‡•á‡§ü‡§æ ‡§∞‡•á‡§ü ‡§∏‡§ø‡§®‡•ç‡§ï‡•ç‡§∞‡•ã‡§®‡§ø‡§ï ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä
##B ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§°‡•á‡§ü‡§æ ‡§∞‡•á‡§ü ‡§∏‡§ø‡§®‡•ç‡§ï‡•ç‡§∞‡•ã‡§®‡§ø‡§ï ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä  
##C ‡§°‡§¨‡§≤ ‡§°‡•á‡§ü‡§æ ‡§∞‡•á‡§ü ‡§∏‡§ø‡§Ç‡§ï‡•ç‡§∞‡•ã‡§®‡§∏ ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä
##D ‡§°‡•á‡§ü‡§æ ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•á‡§ü ‡§∏‡§ø‡§Ç‡§ï‡•ç‡§∞‡•ã‡§®‡§∏ ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä
###ANS: C
###EXP: DDR SDRAM means Double Data Rate Synchronous Dynamic Random Access Memory.

Add [SMILES: ...] for chemical structures
Add [IMAGE_REQUIRED] for diagrams"></textarea>

        <div class="section-title">‚öôÔ∏è Test Configuration</div>
        <div class="config-grid">
          <div class="input-group">
            <label>üìö Test Title</label>
            <input type="text" id="testTitle" value="Basic Computer Literacy Revision Test 1">
          </div>
          <div class="input-group">
            <label>üë§ Student Name</label>
            <input type="text" id="studentName" value="Ravi Kumar">
          </div>
          <div class="input-group">
            <label>‚è±Ô∏è Duration (minutes)</label>
            <input type="number" id="testDuration" value="60" min="1">
          </div>
          <div class="input-group">
            <label>üéØ Total Marks</label>
            <input type="number" id="totalMarks" value="100" min="1">
          </div>
          <div class="input-group">
            <label>‚ûï Marks per Question</label>
            <input type="number" id="marksPerQ" value="3" min="0">
          </div>
          <div class="input-group">
            <label>‚ûñ Negative Marking</label>
            <input type="number" id="negativeMarking" value="-1" step="0.25">
          </div>
        </div>
      </div>

      <div class="btn-container">
        <button class="btn btn-warning" onclick="autoFixFormat()">üõ†Ô∏è Auto-Fix Format</button>
        <button class="btn btn-danger" onclick="loadSample()">üìã Load Sample</button>
        <button class="btn btn-primary" onclick="startTest()">‚ñ∂Ô∏è Start Test</button>
        <button class="btn btn-success" onclick="printVersion()">üñ®Ô∏è Print Q-Paper</button>
      </div>
    </div>
  </div>
</div>

<!-- Test Interface -->
<div class="test-container" id="testContainer">
  <div class="test-header">
    <div class="test-info">
      <div class="test-logo">TB</div>
      <div class="test-title-section">
        <h2 id="displayTestTitle">Mock Test</h2>
        <div class="test-subtitle" id="displaySubtitle">Attempt: 1</div>
      </div>
    </div>
    <div class="timer-section">
      <div class="timer-label">Time Left</div>
      <div class="timer-display" id="timerDisplay">01:00:00</div>
    </div>
  </div>

  <div class="test-main">
    <div class="question-section">
      <div class="question-card">
        <div class="question-header-card">
          <div class="question-meta">
            <div class="question-number-badge" id="questionNumberBadge">Question 1</div>
            <div class="question-info">
              <div class="marks-info" id="marksDisplay">+3 Marks</div>
              <div class="negative-info" id="negativeDisplay">-1 Mark</div>
            </div>
          </div>
          <div class="time-spent" id="timeSpent">‚è±Ô∏è 00:00</div>
        </div>

        <div class="question-content-card">
          <div class="question-text" id="questionTextDisplay">Loading question...</div>
          <div class="options-list" id="optionsList"></div>

          <div class="solution-panel" id="solutionPanel">
            <div class="solution-header">
              <div class="solution-icon">‚úì</div>
              <div class="solution-title">CORRECT ANSWER & EXPLANATION</div>
            </div>
            <div class="solution-correct">
              <strong>Correct Answer:</strong>
              <span class="solution-correct-value" id="correctAnswerValue">A</span>
            </div>
            <div class="solution-explanation">
              <strong>Explanation:</strong>
              <div class="solution-text" id="explanationText">Explanation will appear here...</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="right-sidebar">
      <div class="sidebar-section user-profile">
        <div class="user-avatar-circle" id="userAvatar">R</div>
        <div class="user-name-display" id="userName">Ravi Kumar</div>
        <div class="user-email">test@example.com</div>
      </div>

      <div class="sidebar-section legend-section">
        <div class="section-heading">Question Status</div>
        <div class="legend-items">
          <div class="legend-row">
            <div class="legend-circle answered">1</div>
            <div class="legend-text">Answered</div>
            <div class="legend-count" id="countAnswered">0</div>
          </div>
          <div class="legend-row">
            <div class="legend-circle not-answered">2</div>
            <div class="legend-text">Not Answered</div>
            <div class="legend-count" id="countNotAnswered">0</div>
          </div>
          <div class="legend-row">
            <div class="legend-circle marked">3</div>
            <div class="legend-text">Marked for Review</div>
            <div class="legend-count" id="countMarked">0</div>
          </div>
          <div class="legend-row">
            <div class="legend-circle marked-answered">4</div>
            <div class="legend-text">Marked & Answered</div>
            <div class="legend-count" id="countMarkedAnswered">0</div>
          </div>
          <div class="legend-row">
            <div class="legend-circle not-visited">5</div>
            <div class="legend-text">Not Visited</div>
            <div class="legend-count" id="countNotVisited">10</div>
          </div>
        </div>
      </div>

      <div class="sidebar-section palette-section">
        <div class="section-heading">Question Palette</div>
        <div class="palette-grid" id="paletteGrid"></div>
      </div>

      <div class="submit-section">
        <button class="submit-button" onclick="submitTestConfirm()">üì§ SUBMIT TEST</button>
      </div>
    </div>
  </div>

  <div class="bottom-nav">
    <div class="nav-left">
      <button class="nav-btn nav-btn-mark" onclick="markForReview()">üîñ Mark for Review</button>
      <button class="nav-btn nav-btn-clear" onclick="clearResponse()">‚úñÔ∏è Clear Response</button>
    </div>
    <div class="nav-right">
      <button class="nav-btn nav-btn-prev" onclick="previousQuestion()">‚óÄÔ∏è Previous</button>
      <button class="nav-btn nav-btn-next" onclick="saveAndNext()">Save & Next ‚ñ∂Ô∏è</button>
    </div>
  </div>
</div>

<!-- Results Page -->
<div class="results-page" id="resultsPage">
  <div class="results-container">
    <div class="results-card">
      <div class="results-header">
        <h1>üéâ Test Completed Successfully!</h1>
        <p>Here's your detailed performance report</p>
        <div class="score-showcase">
          <div class="score-value" id="finalScore">0/100</div>
          <div class="score-label">Your Score</div>
        </div>
      </div>

      <div class="results-body">
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-number" id="statTotalScore">0</div>
            <div class="stat-label">Total Score</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="statAccuracy">0%</div>
            <div class="stat-label">Accuracy</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="statCorrect">0</div>
            <div class="stat-label">Correct</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="statIncorrect">0</div>
            <div class="stat-label">Incorrect</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="statTimeTaken">00:00</div>
            <div class="stat-label">Time Taken</div>
          </div>
        </div>

        <div class="analysis-section">
          <div class="analysis-header">Question-wise Analysis</div>
          <div id="questionAnalysisContainer"></div>
        </div>

        <div class="results-actions">
          <button class="btn btn-primary" onclick="reviewAnswers()">üëÅÔ∏è Review Solutions</button>
          <button class="btn btn-warning" onclick="printDetailedReport()">üñ®Ô∏è Print Detailed Report</button>
          <button class="btn btn-success" onclick="restartTest()">üîÑ Take Another Test</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Print Mode -->
<div class="print-mode" id="printMode">
  <div class="print-page" id="printPage"></div>
</div>

<script>
// Global State
let testData = {
  questions: [],
  currentIndex: 0,
  userAnswers: {},
  questionStatus: {},
  questionStartTime: {},
  questionTimeSpent: {},
  config: {},
  testStartTime: null,
  timerInterval: null,
  reviewMode: false
};

// Auto-fix formatting
function autoFixFormat() {
  let text = document.getElementById('inputQuestions').value;
  text = text.replace(/‚îÅ+/g, '');
  text = text.replace(/(?<!\n)###Q/g, '\n###Q');
  text = text.replace(/(?<!\n)##([A-E])/g, '\n##$1');
  text = text.replace(/###ANS\s*:/g, '\n###ANS:');
  text = text.replace(/###EXP\s*:/g, '\n###EXP:');
  document.getElementById('inputQuestions').value = text;
  alert('‚úÖ Formatting fixed successfully!');
}

// Load sample
function loadSample() {
  const sample = `###Q1 DDR SDRAM ‡§ï‡§æ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∞‡•Ç‡§™ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?
##A ‡§°‡§¨‡§≤ ‡§°‡•á‡§ü‡§æ ‡§∞‡•á‡§ü ‡§∏‡§ø‡§®‡•ç‡§ï‡•ç‡§∞‡•ã‡§®‡§ø‡§ï ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä
##B ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§°‡•á‡§ü‡§æ ‡§∞‡•á‡§ü ‡§∏‡§ø‡§®‡•ç‡§ï‡•ç‡§∞‡•ã‡§®‡§ø‡§ï ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä
##C ‡§°‡§¨‡§≤ ‡§°‡•á‡§ü‡§æ ‡§∞‡•á‡§ü ‡§∏‡§ø‡§Ç‡§ï‡•ç‡§∞‡•ã‡§®‡§∏ ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä
##D ‡§°‡•á‡§ü‡§æ ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•á‡§ü ‡§∏‡§ø‡§Ç‡§ï‡•ç‡§∞‡•ã‡§®‡§∏ ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä
###ANS: C
###EXP: DDR SDRAM ‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ Double Data Rate Synchronous Dynamic Random Access Memory ‡§π‡•à‡•§ ‡§Ø‡§π ‡§è‡§ï ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§π‡•à‡•§

###Q2 ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•å‡§® ‡§∏‡§∞‡•ç‡§µ‡§™‡•ç‡§∞‡§•‡§Æ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§≤‡•á‡§ñ‡§® ‡§•‡•Ä?
##A ‡§ï‡•ç‡§Ø‡•Ç‡§®‡§ø‡§´‡§º‡•â‡§∞‡•ç‡§Æ
##B ‡§ö‡§ø‡§§‡•ç‡§∞‡§≤‡•á‡§ñ
##C ‡§π‡§æ‡§Ø‡§∞‡•ã‡§ó‡•ç‡§≤‡§ø‡§´‡§º‡§ø‡§ï‡•ç‡§∏
##D ‡§Æ‡§ø‡§∏‡•ç‡§∞ ‡§ï‡•Ä ‡§π‡§æ‡§Ø‡§∞‡•ã‡§ó‡•ç‡§≤‡§ø‡§´‡§º‡§ø‡§ï‡•ç‡§∏
###ANS: A
###EXP: ‡§ï‡•ç‡§Ø‡•Ç‡§®‡§ø‡§´‡§º‡•â‡§∞‡•ç‡§Æ ‡§∏‡§¨‡§∏‡•á ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§ú‡•ç‡§û‡§æ‡§§ ‡§≤‡•á‡§ñ‡§® ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§≤‡§ó‡§≠‡§ó 3400 ‡§à‡§∏‡§æ ‡§™‡•Ç‡§∞‡•ç‡§µ ‡§Æ‡•á‡§∏‡•ã‡§™‡•ã‡§ü‡§æ‡§Æ‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§ï‡§∏‡§ø‡§§ ‡§π‡•Å‡§à ‡§•‡•Ä‡•§

###Q3 ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•å‡§® ‡§∏‡§æ ‡§ï‡§•‡§® ‡§ó‡§≤‡§§ ‡§π‡•à?
##A ‡§ö‡•Å‡§Ç‡§¨‡§ï‡•Ä‡§Ø ‡§ï‡•ã‡§∞ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä, RAM ‡§î‡§∞ ROM ‡§ï‡§æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§∏‡§Æ‡§Ø ‡§∏‡•ç‡§•‡§ø‡§∞ ‡§π‡•ã‡§§‡§æ ‡§π‡•à
##B ‡§ö‡•Å‡§Ç‡§¨‡§ï‡•Ä‡§Ø ‡§ü‡•á‡§™ ‡§Ö‡§∏‡•ç‡§•‡§ø‡§∞ (non-volatile) ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§
##C ‡§Ö‡§∞‡•ç‡§ß‡§ö‡§æ‡§≤‡§ï ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§¨‡§°‡§º‡•á ‡§™‡•à‡§Æ‡§æ‡§®‡•á ‡§™‡§∞ ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§
##D ‡§è‡§ï EPROM ‡§ï‡•ã ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ EPROM ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ‡§ø‡§Ç‡§ó ‡§â‡§™‡§ï‡§∞‡§£ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ, ‡§Æ‡§ø‡§ü‡§æ‡§Ø‡§æ ‡§î‡§∞ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§
###ANS: C
###EXP: ‡§Ö‡§∞‡•ç‡§ß‡§ö‡§æ‡§≤‡§ï ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§Ü‡§Æ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï ‡§Æ‡•á‡§Æ‡•ã‡§∞‡•Ä ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§¨‡§°‡§º‡•á ‡§™‡•à‡§Æ‡§æ‡§®‡•á ‡§™‡§∞ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§π‡•Ä‡§Ç‡•§

###Q4 ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•å‡§® ‡§∏‡§æ ‡§è‡§ï ‡§≤‡•ã‡§ï‡§™‡•ç‡§∞‡§ø‡§Ø ‡§µ‡•á‡§¨ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§á‡§Ç‡§ú‡§® ‡§ï‡§æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à?
##A ‡§¨‡§ø‡§Ç‡§ó (Bing)
##B ‡§è‡§ú (Edge)
##C ‡§Ø‡§æ‡§π‡•Ç (Yahoo)
##D ‡§ó‡•Ç‡§ó‡§≤ (Google)
###ANS: B
###EXP: Microsoft Edge ‡§è‡§ï ‡§µ‡•á‡§¨ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§π‡•à, ‡§∏‡§∞‡•ç‡§ö ‡§á‡§Ç‡§ú‡§® ‡§®‡§π‡•Ä‡§Ç‡•§ Bing, Yahoo ‡§î‡§∞ Google ‡§∏‡§∞‡•ç‡§ö ‡§á‡§Ç‡§ú‡§® ‡§π‡•à‡§Ç‡•§

###Q5 ‡§µ‡§ø‡§°‡•Ä‡§ú OS ‡§ï‡§æ ‡§ï‡•å‡§® ‡§∏‡§æ ‡§ò‡§ü‡§ï ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ú‡•à‡§∏‡•á ‡§°‡§ø‡§∏‡•ç‡§™‡•ç‡§≤‡•á ‡§∞‡§ø‡§ú‡§º‡•â‡§≤‡•ç‡§Ø‡•Ç‡§∂‡§® ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à?
##A ‡§´‡§æ‡§á‡§≤ ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•ã‡§∞‡§∞
##B ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§™‡•à‡§®‡§≤
##C ‡§ü‡§æ‡§∏‡•ç‡§ï ‡§Æ‡•à‡§®‡•á‡§ú‡§∞
##D ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ü‡•ç‡§∞‡•á
###ANS: B
###EXP: Control Panel ‡§µ‡§ø‡§Ç‡§°‡•ã‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ï‡•ã ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞ ‡§î‡§∞ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§

###Q6 ‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞ ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§ï‡•á ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§Æ‡•á‡§Ç, GIGO ‡§ï‡§æ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∞‡•Ç‡§™ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?
##A ‡§ó‡§æ‡§∞‡•ç‡§¨‡§ø‡§ú ‡§á‡§® ‡§ó‡§æ‡§∞‡•ç‡§¨‡§ø‡§ú ‡§Ü‡§â‡§ü
##B ‡§ó‡•á‡§ü ‡§á‡§® ‡§ó‡•á‡§ü ‡§Ü‡§â‡§ü
##C ‡§ó‡•ã‡§á‡§Ç‡§ó ‡§á‡§® ‡§ó‡•ã‡§á‡§Ç‡§ó ‡§Ü‡§â‡§ü
##D ‡§ó‡•ç‡§≤‡•ã‡§¨‡§æ‡§á‡§° ‡§á‡§® ‡§ó‡•ç‡§≤‡•ã‡§¨‡§æ‡§á‡§° ‡§Ü‡§â‡§ü
###ANS: A
###EXP: GIGO ‡§ï‡§æ ‡§Ö‡§∞‡•ç‡§• ‡§π‡•à "Garbage In, Garbage Out" - ‡§Ö‡§ó‡§∞ ‡§ó‡§≤‡§§ ‡§°‡•á‡§ü‡§æ ‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü ‡§≠‡•Ä ‡§ó‡§≤‡§§ ‡§π‡•ã‡§ó‡§æ‡•§

###Q7 ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§µ‡§æ‡§Ø‡§∞‡§∏ ‡§á‡§®‡•ç‡§´‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡§æ ‡§ñ‡§§‡§∞‡§æ ‡§∏‡§¨‡§∏‡•á ‡§ï‡§Æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?
##A ‡§à-‡§Æ‡•á‡§≤ ‡§Ö‡§ü‡•à‡§ö‡§Æ‡•á‡§Ç‡§ü
##B ‡§™‡•á‡§® ‡§°‡•ç‡§∞‡§æ‡§á‡§µ
##C ‡§∏‡•Ä‡§°‡•Ä-‡§∞‡•ã‡§Æ
##D ‡§á‡§Ç‡§ü‡§∞‡§®‡•á‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°
###ANS: C
###EXP: CD-ROM ‡§Ü‡§Æ‡§§‡•å‡§∞ ‡§™‡§∞ read-only ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§â‡§® ‡§™‡§∞ ‡§µ‡§æ‡§Ø‡§∞‡§∏ ‡§≤‡§ø‡§ñ‡§®‡§æ ‡§Æ‡•Å‡§∂‡•ç‡§ï‡§ø‡§≤ ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§á‡§®‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§ï‡§æ ‡§ñ‡§§‡§∞‡§æ ‡§ï‡§Æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§

###Q8 ‡§Ö‡§Æ‡•á‡§ú‡§® ‡§ï‡•Ä ‡§ï‡•ç‡§≤‡§æ‡§â‡§°-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§µ‡•Ä‡§™‡•Ä‡§è‡§∏ ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?
##A EC2
##B S3
##C Lambda
##D CloudFront
###ANS: A
###EXP: Amazon EC2 (Elastic Compute Cloud) ‡§Ö‡§Æ‡•á‡§ú‡§º‡§® ‡§ï‡•Ä cloud-based Virtual Private Server ‡§∏‡•á‡§µ‡§æ ‡§π‡•à‡•§

###Q9 ‡§¨‡§§‡§æ‡§á‡§è ‡§ï‡§ø ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§•‡§® ‡§∏‡§§‡•ç‡§Ø ‡§π‡•à ‡§Ø‡§æ ‡§Ö‡§∏‡§§‡•ç‡§Ø:
i) MS-Excel 365 ‡§Æ‡•á‡§Ç, ‡§ï‡§Ç‡§°‡•Ä‡§∂‡§®‡§≤ ‡§´‡§º‡•â‡§∞‡•ç‡§Æ‡•á‡§ü‡§ø‡§Ç‡§ó '‡§π‡•ã‡§Æ' ‡§Æ‡•á‡§®‡•Ç ‡§ï‡•á ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§ó‡§§ '‡§∏‡•ç‡§ü‡§æ‡§á‡§≤' ‡§Æ‡•á‡§®‡•Ç ‡§∏‡§Æ‡•Ç‡§π ‡§ï‡§æ ‡§è‡§ï ‡§≠‡§æ‡§ó ‡§π‡•à‡•§
ii) MS-Excel 365 ‡§Æ‡•á‡§Ç, '‡§°‡§ø‡§≤‡•Ä‡§ü ‡§∂‡•Ä‡§ü' ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ '‡§π‡•ã‡§Æ' ‡§Æ‡•á‡§®‡•Ç ‡§Æ‡•á‡§Ç '‡§∏‡•á‡§≤‡•ç‡§∏' ‡§Æ‡•á‡§®‡•Ç ‡§∏‡§Æ‡•Ç‡§π ‡§ï‡•á ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§ó‡§§ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡•§
##A i) ‡§∏‡§§‡•ç‡§Ø, ii) ‡§∏‡§§‡•ç‡§Ø
##B i) ‡§∏‡§§‡•ç‡§Ø, ii) ‡§Ö‡§∏‡§§‡•ç‡§Ø
##C i) ‡§Ö‡§∏‡§§‡•ç‡§Ø, ii) ‡§∏‡§§‡•ç‡§Ø
##D i) ‡§Ö‡§∏‡§§‡•ç‡§Ø, ii) ‡§Ö‡§∏‡§§‡•ç‡§Ø
###ANS: B
###EXP: ‡§ï‡§Ç‡§°‡•Ä‡§∂‡§®‡§≤ ‡§´‡§º‡•â‡§∞‡•ç‡§Æ‡•á‡§ü‡§ø‡§Ç‡§ó '‡§π‡•ã‡§Æ' ‡§ü‡•à‡§¨ ‡§ï‡•á '‡§∏‡•ç‡§ü‡§æ‡§á‡§≤' ‡§ó‡•ç‡§∞‡•Å‡§™ ‡§Æ‡•á‡§Ç ‡§π‡•à (‡§∏‡§§‡•ç‡§Ø), ‡§≤‡•á‡§ï‡§ø‡§® '‡§°‡§ø‡§≤‡•Ä‡§ü ‡§∂‡•Ä‡§ü' ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ '‡§π‡•ã‡§Æ' ‡§ü‡•à‡§¨ ‡§ï‡•á '‡§∏‡•á‡§≤‡•ç‡§∏' ‡§ó‡•ç‡§∞‡•Å‡§™ ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à (‡§Ö‡§∏‡§§‡•ç‡§Ø)‡•§

###Q10 Windows 11 ‡§ë‡§™‡§∞‡•á‡§ü‡§ø‡§Ç‡§ó ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•á‡§Ç, ‡§´‡§æ‡§á‡§≤ ‡§Ø‡§æ ‡§´‡•ã‡§≤‡•ç‡§°‡§∞ ‡§ï‡•á ‡§®‡§æ‡§Æ ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•ç‡§Ø‡§æ ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à?
##A ‡§π‡§æ‡§á‡§´‡§® (-)
##B ‡§Ö‡§Ç‡§°‡§∞‡§∏‡•ç‡§ï‡•ã‡§∞ (_)
##C ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï ‡§ú‡•à‡§∏‡•á ‡§§‡§æ‡§∞‡§æ‡§Ç‡§ï‡§® (*) ‡§Ø‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ö‡§ø‡§π‡•ç‡§® (?)
##D ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§î‡§∞ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§è‡§Ç
###ANS: C
###EXP: Windows ‡§Æ‡•á‡§Ç ‡§´‡§æ‡§á‡§≤ ‡§®‡§æ‡§Æ‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§µ‡§∞‡•ç‡§£ ‡§ú‡•à‡§∏‡•á * ? : < > | \\ / ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§`;

  document.getElementById('inputQuestions').value = sample;
  alert('‚úÖ Sample questions loaded successfully!');
}

// Parse questions
function parseQuestions(rawText) {
  const questions = [];
  const blocks = rawText.split(/###Q/).filter(b => b.trim());

  blocks.forEach((block, idx) => {
    let qNum = block.match(/^\s*(\d+)/)?.[1] || (idx + 1);
    let cleanBlock = block.replace(/^\s*\d+/, '').trim();

    let parts = cleanBlock.split('###ANS');
    let qContent = parts[0];
    let ansContent = parts[1] || '';

    let qText = qContent.split(/##[A-E]/)[0].trim();

    const opts = {};
    ['A', 'B', 'C', 'D', 'E'].forEach(letter => {
      let match = qContent.match(new RegExp(`##${letter}([^#]*)`));
      if (match) {
        opts[letter] = match[1].split(/##[A-E]/)[0].trim();
      }
    });

    let answer = '', explanation = '';
    if (ansContent) {
      let expSplit = ansContent.split('###EXP');
      answer = expSplit[0].replace(/^[:\s\(\)]+/, '').trim();
      explanation = expSplit[1] ? expSplit[1].trim() : '';
    }

    questions.push({
      number: qNum,
      text: qText,
      options: opts,
      correctAnswer: answer,
      explanation: explanation
    });
  });

  return questions;
}

// Format text with SMILES and images
function formatText(text) {
  if (!text) return '';

  text = text.replace(/\[SMILES:\s*([^\]]+)\]/g, (match, smiles) => {
    let id = 'chem_' + Math.random().toString(36).substr(2, 9);
    setTimeout(() => drawChemical(id, smiles), 200);
    return `<canvas id="${id}" class="chem-canvas" width="180" height="120"></canvas>`;
  });

  text = text.replace(/\[IMAGE_REQUIRED\]/g, 
    '<div class="image-placeholder">üì∏ Diagram Required - Insert After Printing</div>');

  return text.replace(/\n/g, '<br>');
}

// Draw chemical structure
function drawChemical(canvasId, smilesStr) {
  if (typeof SmilesDrawer === 'undefined') return;

  try {
    let drawer = new SmilesDrawer.Drawer({
      width: 180,
      height: 120,
      bondThickness: 1.5,
      padding: 8
    });

    SmilesDrawer.parse(smilesStr, (tree) => {
      drawer.draw(tree, canvasId, 'light', false);
    });
  } catch (e) {
    console.error('SMILES drawing error:', e);
  }
}

// Start test
function startTest() {
  const rawText = document.getElementById('inputQuestions').value.trim();
  if (!rawText) {
    alert('‚ö†Ô∏è Please enter questions first!');
    return;
  }

  testData.questions = parseQuestions(rawText);

  if (testData.questions.length === 0) {
    alert('‚ö†Ô∏è No valid questions found!');
    return;
  }

  testData.config = {
    title: document.getElementById('testTitle').value,
    studentName: document.getElementById('studentName').value,
    duration: parseInt(document.getElementById('testDuration').value),
    totalMarks: parseInt(document.getElementById('totalMarks').value),
    marksPerQ: parseInt(document.getElementById('marksPerQ').value),
    negativeMark: parseFloat(document.getElementById('negativeMarking').value)
  };

  testData.currentIndex = 0;
  testData.userAnswers = {};
  testData.questionStatus = {};
  testData.questionStartTime = {};
  testData.questionTimeSpent = {};
  testData.testStartTime = Date.now();
  testData.reviewMode = false;

  testData.questions.forEach((_, i) => {
    testData.questionStatus[i] = 'not-visited';
    testData.questionStartTime[i] = 0;
    testData.questionTimeSpent[i] = 0;
  });

  document.getElementById('displayTestTitle').textContent = testData.config.title;
  document.getElementById('displaySubtitle').textContent = `Total Questions: ${testData.questions.length}`;
  document.getElementById('userName').textContent = testData.config.studentName;
  document.getElementById('userAvatar').textContent = testData.config.studentName[0].toUpperCase();
  document.getElementById('marksDisplay').textContent = `+${testData.config.marksPerQ} Marks`;
  document.getElementById('negativeDisplay').textContent = `${testData.config.negativeMark} Mark`;

  const paletteGrid = document.getElementById('paletteGrid');
  paletteGrid.innerHTML = '';
  testData.questions.forEach((_, i) => {
    const btn = document.createElement('button');
    btn.className = 'palette-button not-visited';
    btn.textContent = i + 1;
    btn.id = `palette-${i}`;
    btn.onclick = () => jumpToQuestion(i);
    paletteGrid.appendChild(btn);
  });

  document.getElementById('setupPage').style.display = 'none';
  document.getElementById('testContainer').style.display = 'flex';

  loadQuestion(0);
  startTimer();
  updateStatusCounts();
}

// Load question
function loadQuestion(index) {
  if (index < 0 || index >= testData.questions.length) return;

  // Save time spent on previous question
  if (testData.currentIndex !== index && testData.questionStartTime[testData.currentIndex] > 0) {
    const timeSpent = Math.floor((Date.now() - testData.questionStartTime[testData.currentIndex]) / 1000);
    testData.questionTimeSpent[testData.currentIndex] += timeSpent;
  }

  testData.currentIndex = index;
  const q = testData.questions[index];

  if (testData.questionStatus[index] === 'not-visited') {
    testData.questionStatus[index] = 'visited';
  }
  testData.questionStartTime[index] = Date.now();

  document.getElementById('questionNumberBadge').textContent = `Question ${parseInt(q.number)}`;
  document.getElementById('questionTextDisplay').innerHTML = formatText(q.text);

  const optionsList = document.getElementById('optionsList');
  optionsList.innerHTML = '';

  Object.keys(q.options).forEach(key => {
    if (q.options[key]) {
      const optDiv = document.createElement('div');
      optDiv.className = 'option-box';

      if (testData.userAnswers[index] === key) {
        optDiv.classList.add('selected');
      }

      // In review mode, show correct/incorrect
      if (testData.reviewMode) {
        if (key === q.correctAnswer) {
          optDiv.classList.add('correct-answer');
        }
        if (testData.userAnswers[index] === key && key !== q.correctAnswer) {
          optDiv.classList.add('wrong-answer');
        }
      }

      if (!testData.reviewMode) {
        optDiv.onclick = () => selectOption(key);
      }

      optDiv.innerHTML = `
        <div class="option-checkbox"></div>
        <div class="option-label-text">${key}.</div>
        <div class="option-content">${formatText(q.options[key])}</div>
      `;
      optionsList.appendChild(optDiv);
    }
  });

  // Show/hide solution based on review mode
  if (testData.reviewMode) {
    document.getElementById('correctAnswerValue').textContent = q.correctAnswer;
    document.getElementById('explanationText').innerHTML = formatText(q.explanation);
    document.getElementById('solutionPanel').classList.add('visible');
  } else {
    document.getElementById('solutionPanel').classList.remove('visible');
  }

  updatePalette();
  updateStatusCounts();

  if (window.MathJax) {
    MathJax.typesetPromise([document.querySelector('.question-content-card')]).catch(e => console.log(e));
  }
}

// Select option
function selectOption(option) {
  const index = testData.currentIndex;
  testData.userAnswers[index] = option;

  if (testData.questionStatus[index] === 'marked') {
    testData.questionStatus[index] = 'marked-answered';
  } else if (testData.questionStatus[index] !== 'marked-answered') {
    testData.questionStatus[index] = 'answered';
  }

  document.querySelectorAll('.option-box').forEach(box => box.classList.remove('selected'));
  event.target.closest('.option-box').classList.add('selected');

  updatePalette();
  updateStatusCounts();
}

// Mark for review
function markForReview() {
  const index = testData.currentIndex;

  if (testData.userAnswers[index]) {
    testData.questionStatus[index] = 'marked-answered';
  } else {
    testData.questionStatus[index] = 'marked';
  }

  updatePalette();
  updateStatusCounts();
  saveAndNext();
}

// Clear response
function clearResponse() {
  const index = testData.currentIndex;
  delete testData.userAnswers[index];

  if (testData.questionStatus[index] === 'marked-answered') {
    testData.questionStatus[index] = 'marked';
  } else if (testData.questionStatus[index] === 'answered') {
    testData.questionStatus[index] = 'visited';
  }

  document.querySelectorAll('.option-box').forEach(box => box.classList.remove('selected'));
  updatePalette();
  updateStatusCounts();
}

// Navigation
function previousQuestion() {
  if (testData.currentIndex > 0) {
    loadQuestion(testData.currentIndex - 1);
  }
}

function saveAndNext() {
  if (testData.currentIndex < testData.questions.length - 1) {
    loadQuestion(testData.currentIndex + 1);
  } else {
    alert('‚úÖ You have reached the last question!');
  }
}

function jumpToQuestion(index) {
  loadQuestion(index);
}

// Update palette
function updatePalette() {
  testData.questions.forEach((_, i) => {
    const btn = document.getElementById(`palette-${i}`);
    if (!btn) return;

    btn.className = 'palette-button';

    const status = testData.questionStatus[i];
    if (status === 'answered') btn.classList.add('answered');
    else if (status === 'marked') btn.classList.add('marked');
    else if (status === 'marked-answered') btn.classList.add('marked-answered');
    else if (status === 'not-visited') btn.classList.add('not-visited');

    if (i === testData.currentIndex) btn.classList.add('active');
  });
}

// Update status counts
function updateStatusCounts() {
  let counts = {
    answered: 0,
    'not-answered': 0,
    marked: 0,
    'marked-answered': 0,
    'not-visited': 0
  };

  testData.questions.forEach((_, i) => {
    const status = testData.questionStatus[i];
    if (status === 'answered') counts.answered++;
    else if (status === 'marked') counts.marked++;
    else if (status === 'marked-answered') counts['marked-answered']++;
    else if (status === 'not-visited') counts['not-visited']++;
  });

  testData.questions.forEach((_, i) => {
    const status = testData.questionStatus[i];
    if ((status === 'visited' || status === 'not-answered') && !testData.userAnswers[i] && status !== 'marked') {
      counts['not-answered']++;
    }
  });

  document.getElementById('countAnswered').textContent = counts.answered + counts['marked-answered'];
  document.getElementById('countNotAnswered').textContent = counts['not-answered'];
  document.getElementById('countMarked').textContent = counts.marked;
  document.getElementById('countMarkedAnswered').textContent = counts['marked-answered'];
  document.getElementById('countNotVisited').textContent = counts['not-visited'];
}

// Timer
function startTimer() {
  let totalSeconds = testData.config.duration * 60;

  testData.timerInterval = setInterval(() => {
    totalSeconds--;

    if (totalSeconds <= 0) {
      clearInterval(testData.timerInterval);
      alert('‚è∞ Time is up! Test will be auto-submitted.');
      setTimeout(() => submitTest(), 1000);
      return;
    }

    const hours = Math.floor(totalSeconds / 3600);
    const mins = Math.floor((totalSeconds % 3600) / 60);
    const secs = totalSeconds % 60;

    const display = `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    document.getElementById('timerDisplay').textContent = display;

    if (totalSeconds <= 300) {
      document.getElementById('timerDisplay').classList.add('warning');
    }

    // Update time spent on current question
    if (testData.questionStartTime[testData.currentIndex] > 0) {
      const qTime = Math.floor((Date.now() - testData.questionStartTime[testData.currentIndex]) / 1000);
      const qMins = Math.floor(qTime / 60);
      const qSecs = qTime % 60;
      document.getElementById('timeSpent').textContent = `‚è±Ô∏è ${String(qMins).padStart(2, '0')}:${String(qSecs).padStart(2, '0')}`;
    }
  }, 1000);
}

// Submit test
function submitTestConfirm() {
  let unattempted = 0;
  testData.questions.forEach((_, i) => {
    if (!testData.userAnswers[i]) unattempted++;
  });

  let msg = `Are you sure you want to submit the test?\n\n`;
  msg += `Answered: ${Object.keys(testData.userAnswers).length}\n`;
  msg += `Unattempted: ${unattempted}\n\n`;
  msg += `This action cannot be undone.`;

  if (confirm(msg)) {
    submitTest();
  }
}

function submitTest() {
  // Save time for current question
  if (testData.questionStartTime[testData.currentIndex] > 0) {
    const timeSpent = Math.floor((Date.now() - testData.questionStartTime[testData.currentIndex]) / 1000);
    testData.questionTimeSpent[testData.currentIndex] += timeSpent;
  }

  clearInterval(testData.timerInterval);

  let correct = 0, incorrect = 0, unattempted = 0;
  let totalScore = 0;

  testData.questions.forEach((q, i) => {
    if (testData.userAnswers[i]) {
      if (testData.userAnswers[i] === q.correctAnswer) {
        correct++;
        totalScore += testData.config.marksPerQ;
      } else {
        incorrect++;
        totalScore += testData.config.negativeMark;
      }
    } else {
      unattempted++;
    }
  });

  const accuracy = testData.questions.length > 0 ? ((correct / testData.questions.length) * 100).toFixed(2) : 0;
  const timeTaken = Math.floor((Date.now() - testData.testStartTime) / 1000);
  const timeMins = Math.floor(timeTaken / 60);
  const timeSecs = timeTaken % 60;

  document.getElementById('finalScore').textContent = `${totalScore}/${testData.config.totalMarks}`;
  document.getElementById('statTotalScore').textContent = totalScore;
  document.getElementById('statAccuracy').textContent = `${accuracy}%`;
  document.getElementById('statCorrect').textContent = correct;
  document.getElementById('statIncorrect').textContent = incorrect;
  document.getElementById('statTimeTaken').textContent = `${String(timeMins).padStart(2, '0')}:${String(timeSecs).padStart(2, '0')}`;

  const analysisContainer = document.getElementById('questionAnalysisContainer');
  analysisContainer.innerHTML = '';

  testData.questions.forEach((q, i) => {
    const userAns = testData.userAnswers[i];
    const isCorrect = userAns === q.correctAnswer;
    const status = userAns ? (isCorrect ? 'correct' : 'incorrect') : 'unattempted';

    const div = document.createElement('div');
    div.className = `question-analysis-item ${status}`;
    div.innerHTML = `
      <div class="analysis-item-header">
        <div class="analysis-q-number">Q.${q.number}: ${formatText(q.text).substring(0, 80)}...</div>
        <div class="analysis-status ${status}">
          ${status === 'correct' ? '‚úì Correct' : (status === 'incorrect' ? '‚úó Incorrect' : '‚óã Not Attempted')}
        </div>
      </div>
      <div class="analysis-item-content">
        ${userAns ? `<div><strong>Your Answer:</strong> ${userAns}</div>` : ''}
        <div><strong>Correct Answer:</strong> ${q.correctAnswer}</div>
        <div style="margin-top: 10px;"><strong>Explanation:</strong> ${formatText(q.explanation)}</div>
      </div>
    `;
    analysisContainer.appendChild(div);
  });

  document.getElementById('testContainer').style.display = 'none';
  document.getElementById('resultsPage').style.display = 'block';

  if (window.MathJax) {
    MathJax.typesetPromise([analysisContainer]).catch(e => console.log(e));
  }
}

// Review answers - FIXED
function reviewAnswers() {
  testData.reviewMode = true;

  document.getElementById('resultsPage').style.display = 'none';
  document.getElementById('testContainer').style.display = 'flex';

  // Disable navigation buttons in review mode
  document.querySelector('.nav-btn-mark').disabled = true;
  document.querySelector('.nav-btn-clear').disabled = true;
  document.querySelector('.submit-button').textContent = 'üîô Back to Results';
  document.querySelector('.submit-button').onclick = function() {
    testData.reviewMode = false;
    document.getElementById('testContainer').style.display = 'none';
    document.getElementById('resultsPage').style.display = 'block';
  };

  testData.currentIndex = 0;
  loadQuestion(0);
}

// Print detailed report - NEW
function printDetailedReport() {
  const printPage = document.getElementById('printPage');
  printPage.innerHTML = '';

  // Calculate stats
  let correct = 0, incorrect = 0, unattempted = 0;
  let totalScore = 0;

  testData.questions.forEach((q, i) => {
    if (testData.userAnswers[i]) {
      if (testData.userAnswers[i] === q.correctAnswer) {
        correct++;
        totalScore += testData.config.marksPerQ;
      } else {
        incorrect++;
        totalScore += testData.config.negativeMark;
      }
    } else {
      unattempted++;
    }
  });

  const accuracy = testData.questions.length > 0 ? ((correct / testData.questions.length) * 100).toFixed(2) : 0;
  const timeTaken = Math.floor((Date.now() - testData.testStartTime) / 1000);
  const timeMins = Math.floor(timeTaken / 60);
  const timeSecs = timeTaken % 60;

  // Header
  let html = `
    <div class="print-report-header">
      <h1>${testData.config.title}</h1>
      <div class="test-info-line"><strong>Student:</strong> ${testData.config.studentName}</div>
      <div class="test-info-line"><strong>Date:</strong> ${new Date().toLocaleDateString('en-IN')}</div>
      <div class="test-info-line"><strong>Total Questions:</strong> ${testData.questions.length}</div>
    </div>

    <!-- Score Card -->
    <div class="print-score-card">
      <div class="print-score-header">
        <h2>üìä Test Performance Summary</h2>
      </div>
      <div class="print-score-main">
        <div class="print-score-value">${totalScore} / ${testData.config.totalMarks}</div>
      </div>
      <div class="print-score-stats">
        <div class="print-stat-item correct">
          <div class="print-stat-number">${correct}</div>
          <div class="print-stat-label">CORRECT</div>
        </div>
        <div class="print-stat-item incorrect">
          <div class="print-stat-number">${incorrect}</div>
          <div class="print-stat-label">INCORRECT</div>
        </div>
        <div class="print-stat-item unattempted">
          <div class="print-stat-number">${unattempted}</div>
          <div class="print-stat-label">UNATTEMPTED</div>
        </div>
        <div class="print-stat-item accuracy">
          <div class="print-stat-number">${accuracy}%</div>
          <div class="print-stat-label">ACCURACY</div>
        </div>
        <div class="print-stat-item time">
          <div class="print-stat-number">${String(timeMins).padStart(2, '0')}:${String(timeSecs).padStart(2, '0')}</div>
          <div class="print-stat-label">TIME TAKEN</div>
        </div>
      </div>
    </div>

    <!-- Questions -->
    <div class="print-questions-section">
      <div class="print-section-title">üìù Detailed Question Analysis</div>
  `;

  // Add each question
  testData.questions.forEach((q, i) => {
    const userAns = testData.userAnswers[i];
    const isCorrect = userAns === q.correctAnswer;
    const status = userAns ? (isCorrect ? 'correct' : 'incorrect') : 'unattempted';

    // Calculate time spent
    const timeSpent = testData.questionTimeSpent[i] || 0;
    const qMins = Math.floor(timeSpent / 60);
    const qSecs = timeSpent % 60;

    html += `
      <div class="print-question-block no-page-break">
        <div class="print-q-header">
          <div class="print-q-number">Question ${q.number}</div>
          <div class="print-q-badges">
            <div class="print-badge marks">+${testData.config.marksPerQ} / ${testData.config.negativeMark}</div>
            <div class="print-badge time">‚è±Ô∏è ${String(qMins).padStart(2, '0')}:${String(qSecs).padStart(2, '0')}</div>
            <div class="print-badge ${status}">${status === 'correct' ? '‚úì Correct' : (status === 'incorrect' ? '‚úó Incorrect' : '‚óã Unattempted')}</div>
          </div>
        </div>

        <div class="print-q-text">${formatText(q.text)}</div>

        <div class="print-options">
    `;

    // Add all options with indicators
    Object.keys(q.options).forEach(key => {
      if (q.options[key]) {
        const isUserSelected = userAns === key;
        const isCorrectAnswer = key === q.correctAnswer;

        let optionClass = 'print-option';
        if (isUserSelected) optionClass += ' user-selected';
        if (isCorrectAnswer) optionClass += ' is-correct';

        html += `
          <div class="${optionClass}">
            <div class="print-option-indicator"></div>
            <div class="print-option-label">${key}.</div>
            <div class="print-option-text">${formatText(q.options[key])}</div>
          </div>
        `;
      }
    });

    // Add explanation
    html += `
        </div>

        <div class="print-explanation">
          <div class="print-explanation-title">üí° Explanation:</div>
          <div class="print-explanation-text">${formatText(q.explanation)}</div>
        </div>
      </div>
    `;
  });

  html += `</div>`;

  printPage.innerHTML = html;

  // Render MathJax then print
  if (window.MathJax) {
    MathJax.typesetPromise([printPage]).then(() => {
      window.print();
    }).catch(e => {
      console.log(e);
      window.print();
    });
  } else {
    window.print();
  }
}

// Print version (question paper only)
function printVersion() {
  const rawText = document.getElementById('inputQuestions').value.trim();
  if (!rawText) {
    alert('‚ö†Ô∏è Please enter questions first!');
    return;
  }

  const questions = parseQuestions(rawText);
  const config = {
    title: document.getElementById('testTitle').value,
    studentName: document.getElementById('studentName').value,
    duration: document.getElementById('testDuration').value,
    totalMarks: document.getElementById('totalMarks').value
  };

  const printPage = document.getElementById('printPage');

  let html = `
    <div class="print-report-header">
      <h1>${config.title}</h1>
      <div class="test-info-line"><strong>Student:</strong> ${config.studentName}</div>
      <div class="test-info-line"><strong>Time:</strong> ${config.duration} mins | <strong>Total Marks:</strong> ${config.totalMarks}</div>
    </div>

    <div style="column-count: 2; column-gap: 30px; margin-top: 20px;">
  `;

  questions.forEach(q => {
    html += `
      <div style="break-inside: avoid; margin-bottom: 20px;">
        <div style="font-weight: 700; color: #00bcd4; margin-bottom: 10px;">Q.${q.number}</div>
        <div style="margin-bottom: 12px; line-height: 1.7;">${formatText(q.text)}</div>
        <div style="margin-left: 20px;">
    `;

    Object.keys(q.options).forEach(key => {
      if (q.options[key]) {
        html += `<div style="margin-bottom: 8px;"><strong>${key}.</strong> ${formatText(q.options[key])}</div>`;
      }
    });

    html += `
        </div>
      </div>
    `;
  });

  html += `</div>`;

  printPage.innerHTML = html;

  if (window.MathJax) {
    MathJax.typesetPromise([printPage]).then(() => {
      window.print();
    }).catch(e => {
      console.log(e);
      window.print();
    });
  } else {
    window.print();
  }
}

// Restart test
function restartTest() {
  location.reload();
}
</script>

</body>
</html>